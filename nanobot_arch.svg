<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 620" font-family="Inter, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif">
  <defs>
    <marker id="arrow" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#94a3b8"/>
    </marker>
    <marker id="ab" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#3b82f6"/>
    </marker>
    <marker id="ag" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#22c55e"/>
    </marker>
    <marker id="ao" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#f97316"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1100" height="620" rx="8" fill="#f8fafc"/>

  <!-- ======================== CHANNELS ======================== -->
  <g transform="translate(30, 30)">
    <rect width="130" height="300" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="65" y="22" text-anchor="middle" font-size="9" font-weight="600" fill="#334155" letter-spacing="0.5">CHANNELS</text>

    <rect x="15" y="38" width="100" height="48" rx="8" fill="#e0f2fe" stroke="#7dd3fc" stroke-width="0.5"/>
    <text x="65" y="58" text-anchor="middle" font-size="11" font-weight="600" fill="#1e293b">Telegram</text>
    <text x="65" y="70" text-anchor="middle" font-size="7" fill="#94a3b8">Bot API polling</text>

    <rect x="15" y="94" width="100" height="48" rx="8" fill="#dcfce7" stroke="#86efac" stroke-width="0.5"/>
    <text x="65" y="114" text-anchor="middle" font-size="11" font-weight="600" fill="#1e293b">WhatsApp</text>
    <text x="65" y="126" text-anchor="middle" font-size="7" fill="#94a3b8">Baileys bridge (WS)</text>

    <rect x="15" y="150" width="100" height="48" rx="8" fill="#ede9fe" stroke="#c4b5fd" stroke-width="0.5"/>
    <text x="65" y="170" text-anchor="middle" font-size="11" font-weight="600" fill="#1e293b">Discord</text>
    <text x="65" y="182" text-anchor="middle" font-size="7" fill="#94a3b8">discord.py</text>

    <rect x="15" y="206" width="100" height="48" rx="8" fill="#fef3c7" stroke="#fcd34d" stroke-width="0.5"/>
    <text x="65" y="226" text-anchor="middle" font-size="11" font-weight="600" fill="#1e293b">Feishu</text>
    <text x="65" y="238" text-anchor="middle" font-size="7" fill="#94a3b8">WebSocket long-conn</text>

    <text x="65" y="275" text-anchor="middle" font-size="7" fill="#94a3b8">BaseChannel interface</text>
    <text x="65" y="286" text-anchor="middle" font-size="7" fill="#94a3b8">start() · send() · send_reaction()</text>
  </g>

  <!-- ======================== MESSAGE BUS ======================== -->
  <g transform="translate(195, 60)">
    <rect width="100" height="240" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="50" y="22" text-anchor="middle" font-size="9" font-weight="600" fill="#334155" letter-spacing="0.5">BUS</text>

    <rect x="12" y="38" width="76" height="50" rx="6" fill="#dbeafe" stroke="#93c5fd" stroke-width="0.5"/>
    <text x="50" y="56" text-anchor="middle" font-size="11" font-weight="600" fill="#1e40af">inbound</text>
    <text x="50" y="68" text-anchor="middle" font-size="7" fill="#94a3b8">asyncio.Queue</text>
    <text x="50" y="78" text-anchor="middle" font-size="7" fill="#94a3b8">dedup + backpressure</text>

    <rect x="12" y="98" width="76" height="50" rx="6" fill="#d1fae5" stroke="#6ee7b7" stroke-width="0.5"/>
    <text x="50" y="116" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">outbound</text>
    <text x="50" y="128" text-anchor="middle" font-size="7" fill="#94a3b8">asyncio.Queue</text>
    <text x="50" y="138" text-anchor="middle" font-size="7" fill="#94a3b8">text + media</text>

    <rect x="12" y="158" width="76" height="50" rx="6" fill="#fef9c3" stroke="#fde047" stroke-width="0.5"/>
    <text x="50" y="176" text-anchor="middle" font-size="11" font-weight="600" fill="#854d0e">reaction</text>
    <text x="50" y="188" text-anchor="middle" font-size="7" fill="#94a3b8">asyncio.Queue</text>
    <text x="50" y="198" text-anchor="middle" font-size="7" fill="#94a3b8">emoji reactions</text>

    <text x="50" y="228" text-anchor="middle" font-size="7" fill="#94a3b8">bounded · async</text>
  </g>

  <!-- ======================== ORCHESTRATOR ======================== -->
  <g transform="translate(330, 30)">
    <rect width="280" height="375" rx="10" fill="#ffffff" stroke="#6366f1" stroke-width="1.5"/>
    <rect width="280" height="28" rx="10" fill="#6366f1"/>
    <rect x="0" y="14" width="280" height="14" fill="#6366f1"/>
    <text x="140" y="19" text-anchor="middle" font-size="10" font-weight="600" fill="#ffffff">ORCHESTRATOR PIPELINE</text>

    <!-- Steps -->
    <g transform="translate(16, 38)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">1. Deduplication</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#94a3b8">TTL window</text>
    </g>
    <g transform="translate(16, 64)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">2. Archive inbound</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#7c3aed" font-style="italic">ReplyArchivePort</text>
    </g>
    <g transform="translate(16, 90)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">3. Resolve reply + ambient context</text>
    </g>
    <g transform="translate(16, 116)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">4. Admin command routing</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#94a3b8">/policy namespace</text>
    </g>
    <g transform="translate(16, 142)">
      <rect width="248" height="22" rx="4" fill="#eef2ff" stroke="#a5b4fc" stroke-width="0.5"/>
      <text x="8" y="15" font-size="8" fill="#3730a3" font-weight="600">5. Policy evaluation</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#7c3aed" font-style="italic">PolicyPort</text>
    </g>
    <g transform="translate(16, 168)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">6. Idea / backlog capture</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#94a3b8">→ reaction</text>
    </g>
    <g transform="translate(16, 194)">
      <rect width="248" height="22" rx="4" fill="#fef2f2" stroke="#fca5a5" stroke-width="0.5"/>
      <text x="8" y="15" font-size="8" fill="#991b1b" font-weight="600">7. Security input check</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#7c3aed" font-style="italic">SecurityPort</text>
    </g>
    <g transform="translate(16, 220)">
      <rect width="248" height="28" rx="4" fill="#eff6ff" stroke="#60a5fa" stroke-width="0.5"/>
      <text x="8" y="13" font-size="8" fill="#1e40af" font-weight="600">8. LLM response generation</text>
      <text x="240" y="13" text-anchor="end" font-size="7" fill="#7c3aed" font-style="italic">ResponderPort</text>
      <text x="8" y="23" font-size="7" fill="#94a3b8">agent loop · tools · context · memory retrieval</text>
    </g>
    <g transform="translate(16, 252)">
      <rect width="248" height="22" rx="4" fill="#fef2f2" stroke="#fca5a5" stroke-width="0.5"/>
      <text x="8" y="15" font-size="8" fill="#991b1b">9. Security output check</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#94a3b8">sanitize / block</text>
    </g>
    <g transform="translate(16, 278)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">10. Voice synthesis (optional)</text>
      <text x="240" y="15" text-anchor="end" font-size="7" fill="#94a3b8">TTS</text>
    </g>
    <g transform="translate(16, 304)">
      <rect width="248" height="22" rx="4" fill="#f1f5f9"/>
      <text x="8" y="15" font-size="8" fill="#475569">11. Session persist + memory capture</text>
    </g>

    <!-- Intent output -->
    <rect x="16" y="334" width="248" height="28" rx="6" fill="#eef2ff" stroke="#6366f1" stroke-width="0.5"/>
    <text x="140" y="352" text-anchor="middle" font-size="8" fill="#4338ca" font-weight="600">→ emit OrchestratorIntent[]</text>
  </g>

  <!-- ======================== POLICY ENGINE ======================== -->
  <g transform="translate(648, 30)">
    <rect width="195" height="95" rx="10" fill="#ffffff" stroke="#a78bfa" stroke-width="1"/>
    <rect width="195" height="24" rx="10" fill="#8b5cf6"/>
    <rect x="0" y="12" width="195" height="12" fill="#8b5cf6"/>
    <text x="97" y="17" text-anchor="middle" font-size="9" font-weight="600" fill="#ffffff">POLICY ENGINE</text>
    <text x="12" y="42" font-size="8" fill="#475569">evaluate(event) → PolicyDecision</text>
    <text x="12" y="54" font-size="7" fill="#94a3b8">who can talk · when to reply</text>
    <text x="12" y="64" font-size="7" fill="#94a3b8">allowed tools · persona selection</text>
    <text x="12" y="78" font-size="7" fill="#7c3aed">Hot-reload from ~/.nanobot/policy.json</text>
    <text x="12" y="88" font-size="7" fill="#7c3aed">Deterministic — no ad-hoc ACLs</text>
  </g>

  <!-- ======================== SECURITY ENGINE ======================== -->
  <g transform="translate(648, 140)">
    <rect width="195" height="80" rx="10" fill="#ffffff" stroke="#f87171" stroke-width="1"/>
    <rect width="195" height="24" rx="10" fill="#ef4444"/>
    <rect x="0" y="12" width="195" height="12" fill="#ef4444"/>
    <text x="97" y="17" text-anchor="middle" font-size="9" font-weight="600" fill="#ffffff">SECURITY ENGINE</text>
    <text x="12" y="42" font-size="8" fill="#475569">3-stage: input → tool → output</text>
    <text x="12" y="54" font-size="7" fill="#94a3b8">injection detection · secret scanning</text>
    <text x="12" y="64" font-size="7" fill="#94a3b8">sensitive data redaction · fail-closed</text>
  </g>

  <!-- ======================== LLM RESPONDER ======================== -->
  <g transform="translate(648, 235)">
    <rect width="195" height="118" rx="10" fill="#ffffff" stroke="#3b82f6" stroke-width="1"/>
    <rect width="195" height="24" rx="10" fill="#3b82f6"/>
    <rect x="0" y="12" width="195" height="12" fill="#3b82f6"/>
    <text x="97" y="17" text-anchor="middle" font-size="9" font-weight="600" fill="#ffffff">LLM RESPONDER</text>

    <text x="12" y="40" font-size="8" fill="#475569" font-weight="600">Agent Loop</text>
    <text x="12" y="52" font-size="7" fill="#94a3b8">prompt → LLM → tool call → loop</text>

    <text x="12" y="68" font-size="8" fill="#475569" font-weight="600">Context Builder</text>
    <text x="12" y="80" font-size="7" fill="#94a3b8">persona · reply context · ambient</text>
    <text x="12" y="90" font-size="7" fill="#94a3b8">memory retrieval · skills · system</text>

    <text x="12" y="106" font-size="8" fill="#475569" font-weight="600">Tool Registry</text>
    <text x="12" y="116" font-size="7" fill="#94a3b8">exec(bwrap) · fs · web · cron · voice</text>
  </g>

  <!-- ======================== MEMORY SERVICE ======================== -->
  <g transform="translate(648, 368)">
    <rect width="195" height="80" rx="10" fill="#ffffff" stroke="#22c55e" stroke-width="1"/>
    <rect width="195" height="24" rx="10" fill="#22c55e"/>
    <rect x="0" y="12" width="195" height="12" fill="#22c55e"/>
    <text x="97" y="17" text-anchor="middle" font-size="9" font-weight="600" fill="#ffffff">MEMORY SERVICE</text>
    <text x="12" y="42" font-size="8" fill="#475569">SQLite (FTS + embeddings)</text>
    <text x="12" y="54" font-size="7" fill="#94a3b8">semantic recall · background notes</text>
    <text x="12" y="64" font-size="7" fill="#94a3b8">session state · scope filters</text>
  </g>

  <!-- ======================== PROVIDERS ======================== -->
  <g transform="translate(870, 30)">
    <rect width="200" height="210" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="100" y="20" text-anchor="middle" font-size="9" font-weight="600" fill="#334155">PROVIDER REGISTRY</text>
    <text x="100" y="33" text-anchor="middle" font-size="7" fill="#94a3b8">LiteLLM · auto-prefix · env fallback</text>

    <rect x="10" y="42" width="84" height="18" rx="4" fill="#fef3c7"/>
    <text x="52" y="55" text-anchor="middle" font-size="7" fill="#92400e">OpenRouter</text>
    <rect x="100" y="42" width="84" height="18" rx="4" fill="#fef3c7"/>
    <text x="142" y="55" text-anchor="middle" font-size="7" fill="#92400e">AiHubMix</text>

    <rect x="10" y="64" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="52" y="77" text-anchor="middle" font-size="7" fill="#9a3412">Anthropic</text>
    <rect x="100" y="64" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="142" y="77" text-anchor="middle" font-size="7" fill="#9a3412">OpenAI</text>

    <rect x="10" y="86" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="52" y="99" text-anchor="middle" font-size="7" fill="#9a3412">DeepSeek</text>
    <rect x="100" y="86" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="142" y="99" text-anchor="middle" font-size="7" fill="#9a3412">Gemini</text>

    <rect x="10" y="108" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="52" y="121" text-anchor="middle" font-size="7" fill="#9a3412">Groq</text>
    <rect x="100" y="108" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="142" y="121" text-anchor="middle" font-size="7" fill="#9a3412">DashScope</text>

    <rect x="10" y="130" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="52" y="143" text-anchor="middle" font-size="7" fill="#9a3412">Moonshot</text>
    <rect x="100" y="130" width="84" height="18" rx="4" fill="#fff7ed"/>
    <text x="142" y="143" text-anchor="middle" font-size="7" fill="#9a3412">Zhipu AI</text>

    <rect x="10" y="152" width="84" height="18" rx="4" fill="#f0fdf4" stroke="#86efac" stroke-width="0.5"/>
    <text x="52" y="165" text-anchor="middle" font-size="7" fill="#166534">vLLM (local)</text>
    <rect x="100" y="152" width="84" height="18" rx="4" fill="#faf5ff" stroke="#d8b4fe" stroke-width="0.5"/>
    <text x="142" y="165" text-anchor="middle" font-size="7" fill="#7e22ce">ElevenLabs</text>

    <text x="100" y="190" text-anchor="middle" font-size="7" fill="#94a3b8">config.json · .env · env vars</text>
    <text x="100" y="201" text-anchor="middle" font-size="7" fill="#94a3b8">2 files to add a new provider</text>
  </g>

  <!-- ======================== MEDIA ======================== -->
  <g transform="translate(870, 260)">
    <rect width="200" height="80" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="100" y="20" text-anchor="middle" font-size="9" font-weight="600" fill="#334155">MEDIA</text>
    <rect x="10" y="30" width="56" height="18" rx="4" fill="#faf5ff"/>
    <text x="38" y="43" text-anchor="middle" font-size="7" fill="#7e22ce">ASR</text>
    <rect x="72" y="30" width="56" height="18" rx="4" fill="#faf5ff"/>
    <text x="100" y="43" text-anchor="middle" font-size="7" fill="#7e22ce">TTS</text>
    <rect x="134" y="30" width="56" height="18" rx="4" fill="#faf5ff"/>
    <text x="162" y="43" text-anchor="middle" font-size="7" fill="#7e22ce">Vision</text>
    <text x="100" y="68" text-anchor="middle" font-size="7" fill="#94a3b8">ModelRouter · Storage</text>
  </g>

  <!-- ======================== SERVICES ======================== -->
  <g transform="translate(870, 360)">
    <rect width="200" height="88" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="100" y="20" text-anchor="middle" font-size="9" font-weight="600" fill="#334155">SERVICES</text>
    <rect x="10" y="30" width="56" height="18" rx="4" fill="#f0f9ff"/>
    <text x="38" y="43" text-anchor="middle" font-size="7" fill="#0369a1">Cron</text>
    <rect x="72" y="30" width="56" height="18" rx="4" fill="#f0f9ff"/>
    <text x="100" y="43" text-anchor="middle" font-size="7" fill="#0369a1">Heartbeat</text>
    <rect x="134" y="30" width="56" height="18" rx="4" fill="#f0f9ff"/>
    <text x="162" y="43" text-anchor="middle" font-size="7" fill="#0369a1">Sessions</text>
    <rect x="10" y="54" width="56" height="18" rx="4" fill="#f0f9ff"/>
    <text x="38" y="67" text-anchor="middle" font-size="7" fill="#0369a1">Archive</text>
    <rect x="72" y="54" width="56" height="18" rx="4" fill="#f0f9ff"/>
    <text x="100" y="67" text-anchor="middle" font-size="7" fill="#0369a1">Skills</text>
    <rect x="134" y="54" width="56" height="18" rx="4" fill="#f0f9ff"/>
    <text x="162" y="67" text-anchor="middle" font-size="7" fill="#0369a1">Telemetry</text>
  </g>

  <!-- ======================== CONFIG ======================== -->
  <g transform="translate(30, 470)">
    <rect width="285" height="75" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="142" y="20" text-anchor="middle" font-size="9" font-weight="600" fill="#334155">CONFIGURATION</text>
    <rect x="10" y="30" width="82" height="34" rx="6" fill="#f8fafc" stroke="#e2e8f0" stroke-width="0.5"/>
    <text x="51" y="46" text-anchor="middle" font-size="7" fill="#475569">~/.nanobot/</text>
    <text x="51" y="56" text-anchor="middle" font-size="7" fill="#475569">config.json</text>
    <rect x="100" y="30" width="82" height="34" rx="6" fill="#f8fafc" stroke="#a78bfa" stroke-width="0.5"/>
    <text x="141" y="46" text-anchor="middle" font-size="7" fill="#6d28d9">~/.nanobot/</text>
    <text x="141" y="56" text-anchor="middle" font-size="7" fill="#6d28d9">policy.json</text>
    <rect x="190" y="30" width="82" height="34" rx="6" fill="#f8fafc" stroke="#e2e8f0" stroke-width="0.5"/>
    <text x="231" y="46" text-anchor="middle" font-size="7" fill="#475569">~/.nanobot/</text>
    <text x="231" y="56" text-anchor="middle" font-size="7" fill="#475569">.env</text>
  </g>

  <!-- CLI -->
  <g transform="translate(340, 470)">
    <rect width="270" height="75" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="135" y="20" text-anchor="middle" font-size="9" font-weight="600" fill="#334155">CLI (typer)</text>
    <text x="135" y="38" text-anchor="middle" font-size="7" fill="#94a3b8">nanobot gateway · agent · status · logs</text>
    <text x="135" y="50" text-anchor="middle" font-size="7" fill="#94a3b8">nanobot policy explain · cmd · annotate</text>
    <text x="135" y="62" text-anchor="middle" font-size="7" fill="#94a3b8">nanobot memory · cron · channels · config</text>
  </g>

  <!-- ======================== PORT LEGEND ======================== -->
  <g transform="translate(648, 470)">
    <rect width="420" height="75" rx="10" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
    <text x="210" y="18" text-anchor="middle" font-size="9" font-weight="600" fill="#334155">PORT INTERFACES (core/ports.py)</text>
    <text x="12" y="36" font-size="7" fill="#8b5cf6">■</text>
    <text x="22" y="36" font-size="8" fill="#475569">PolicyPort → EnginePolicyAdapter</text>
    <text x="210" y="36" font-size="7" fill="#ef4444">■</text>
    <text x="220" y="36" font-size="8" fill="#475569">SecurityPort → SecurityEngine</text>
    <text x="12" y="50" font-size="7" fill="#3b82f6">■</text>
    <text x="22" y="50" font-size="8" fill="#475569">ResponderPort → LLMResponder</text>
    <text x="210" y="50" font-size="7" fill="#22c55e">■</text>
    <text x="220" y="50" font-size="8" fill="#475569">ReplyArchivePort → SqliteArchiveAdapter</text>
    <text x="12" y="64" font-size="7" fill="#64748b">■</text>
    <text x="22" y="64" font-size="8" fill="#475569">TelemetryPort → InMemoryTelemetry</text>
    <text x="210" y="64" font-size="7" fill="#94a3b8">- - -</text>
    <text x="232" y="64" font-size="8" fill="#94a3b8">dashed lines = port calls</text>
  </g>

  <!-- ======================== FLOW LEGEND ======================== -->
  <g transform="translate(30, 560)">
    <rect width="1038" height="40" rx="8" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="0.5"/>
    <line x1="20" y1="20" x2="50" y2="20" stroke="#3b82f6" stroke-width="2"/>
    <text x="56" y="24" font-size="7" fill="#94a3b8">Inbound (message in)</text>
    <line x1="170" y1="20" x2="200" y2="20" stroke="#22c55e" stroke-width="2"/>
    <text x="206" y="24" font-size="7" fill="#94a3b8">Outbound (reply out)</text>
    <line x1="320" y1="20" x2="350" y2="20" stroke="#f97316" stroke-width="2"/>
    <text x="356" y="24" font-size="7" fill="#94a3b8">Reaction (emoji)</text>
    <line x1="450" y1="20" x2="480" y2="20" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="4,2"/>
    <text x="486" y="24" font-size="7" fill="#94a3b8">Port interface call</text>
    <text x="640" y="24" font-size="7" fill="#475569">Hexagonal architecture · Typed intents · Async throughout · ~18k LOC</text>
  </g>

  <!-- ======================== ARROWS ======================== -->

  <!-- Channels → Bus (inbound) -->
  <line x1="160" y1="105" x2="193" y2="105" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#ab)"/>
  <text x="177" y="99" text-anchor="middle" font-size="7" fill="#3b82f6">in</text>

  <!-- Bus → Channels (outbound) -->
  <line x1="195" y1="168" x2="162" y2="168" stroke="#22c55e" stroke-width="1.5" marker-end="url(#ag)"/>
  <text x="178" y="162" text-anchor="middle" font-size="7" fill="#22c55e">out</text>

  <!-- Bus → Channels (reaction) -->
  <line x1="195" y1="230" x2="162" y2="230" stroke="#f97316" stroke-width="1.5" marker-end="url(#ao)"/>
  <text x="178" y="224" text-anchor="middle" font-size="7" fill="#f97316">rxn</text>

  <!-- Bus → Orchestrator (inbound) -->
  <line x1="295" y1="105" x2="328" y2="105" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#ab)"/>

  <!-- Orchestrator → Bus (outbound intents) -->
  <path d="M 330 380 L 310 380 L 310 168 L 297 168" stroke="#22c55e" stroke-width="1.5" fill="none" marker-end="url(#ag)"/>
  <text x="318" y="276" text-anchor="middle" font-size="7" fill="#22c55e" transform="rotate(-90, 318, 276)">intents</text>

  <!-- Orchestrator → Bus (reaction intents) -->
  <path d="M 330 395 L 300 395 L 300 230 L 297 230" stroke="#f97316" stroke-width="1.5" fill="none" marker-end="url(#ao)"/>

  <!-- Orchestrator → Policy -->
  <line x1="610" y1="78" x2="646" y2="78" stroke="#8b5cf6" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>
  <!-- Orchestrator → Security -->
  <line x1="610" y1="180" x2="646" y2="180" stroke="#ef4444" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>
  <!-- Orchestrator → Responder -->
  <line x1="610" y1="290" x2="646" y2="290" stroke="#3b82f6" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>
  <!-- Orchestrator → Memory -->
  <line x1="610" y1="370" x2="646" y2="408" stroke="#22c55e" stroke-width="1.2" stroke-dasharray="4,2" marker-end="url(#arrow)"/>

  <!-- Responder → Providers -->
  <line x1="843" y1="290" x2="868" y2="150" stroke="#94a3b8" stroke-width="1" stroke-dasharray="3,2" marker-end="url(#arrow)"/>
  <!-- Responder → Media -->
  <line x1="843" y1="310" x2="868" y2="300" stroke="#94a3b8" stroke-width="1" stroke-dasharray="3,2" marker-end="url(#arrow)"/>
</svg>
